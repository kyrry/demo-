<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vue慕课网 ---购物车案例课程安排 </title>
    <link href="css/bootstrap.css" rel="stylesheet" />"
    <style>
    	.item-chek-btn { width: 20px; height: 20px; display: inline-block; background: url("img/1.jpg") no-repeat 100% 100%;}
    	.checked { background: url("img/2.jpg") no-repeat 100% 100%;}
    </style>
   
    <script src="js/jquery.js"></script>
    <script src="js/bootstrap-modal.js"></script>
    <script src="js/vue.js"></script><!-- 这里的顺序不要变1 -->
	<script src="js/vue-resource.js"></script><!-- 这里的顺序不要变2 -->
	
	
</head>
<body>
	
<div id="app">
 <div class="container">
 		<h2>{{ title }}</h2>	
		<table class="table" >
			<thead>
				<tr>
					<th>&nbsp</th>
					<th>商品信息</th>
					<th>商品金额</th>
					<th>商品数量</th>
					<th>总金额</th>
					<th>编辑</th>					
				</tr>
			</thead>
			<tbody >
				<tr v-for="(item,index) in productList">
					<!--(item,index) 相当于js的 foreach(value,index);//foreach(值,序号)  jq each(index[序号],value[值])-->
					<td><a href="javascript:;" class="item-chek-btn  " v-bind:class="{'checked':item.checked}" @click="selectedProduct(item)" ></a></td>
					<td><img  :src="item.productImage" alet="" width="30" height="30" > {{index +" | "+ item.productName }}</td>
					<td>{{ item.productPrice | formatMoney  }}</td>
					<td>
						<button type="button"  class="btn btn-danger" v-on:click="changeMoney(item,-1)">-</button>
						<div style="display: inline-block; min-width: 30px; text-align: center;"><input type="text" value="0" v-model="item.productQuentity"   ></div>
						<button type="button"  class="btn btn-danger" @click="changeMoney(item,1)">+</button>
					</td>
					<td>{{ item.productPrice*item.productQuentity | money("元 ") }}</td>					
					<td>						
						<!--<button type="button" class="btn btn-danger">移除</button>-->
						<a data-toggle="modal" href="#example" class="btn btn-primary btn-large" @click="delConfirm(item)">移除</a>	
						
					</td>
				</tr>
				
				<tr>
					<!--@click="checkAllFlag=true" 可以是函数  三元 checkAllFlay==true?true:false 可以是表达式（一元表达式或三元表达式 别写业务逻辑 如 var dd=true ... ） -->
					<td><a href="javascript:;" class="item-chek-btn " id="checkall"  :class="{'checked':checkAllFlag}"  @click="checkAll('checkall',true)"></a>全选</td>
					<td @click="checkAll('checkall',false)">取消全选</td>
					<td>总购买价 : {{ totalMoney }}</td>
					<td>总购买数量</td>
					<td>2</td>
					<td colspan="2"><button  type="button" class="btn btn-danger">清空购物车</button></td>
				</tr>
			</tbody>   				
		</table>
		<p >您的购物车为空</p>
   	</div>
   	<!--删除的一个区域start-->
   	<div class="container"   id="showModal" v-bind:class="{'md-show':delFlag}">
		<h2>Example of creating Modals with Bootstrap</h2>
		<div id="example" class="modal hide fade in" style="display: none; ">
			<div class="modal-header">
				<a class="close" data-dismiss="modal"   @click="delFlag=false">×</a>
				<h3>删除订单</h3>
			</div>
			<div class="modal-body">				
				<p>你确定删除此订单信息吗</p>
			</div>
			<div class="modal-footer">
				<a href="#" class="btn btn-success" id="btnModalConfirm" @click="delProduct()">确定删除</a>
				<a href="#" class="btn" data-dismiss="modal" id="btnModalCancel" @click="delFlag=false" >取消删除</a>
			</div>
		</div>
	</div>
	<!--删除的一个区域 end -->
	
	<!--<p><a data-toggle="modal" href="#example" class="btn btn-primary btn-large">Launch demo modal</a></p>-->
</div>

<script>	
	/*创建一个Vue的实例
	 *通过v-for指令渲染产品数据 
	 *使用Filter对金额和图片进行格式化 
	 *使用V-on实现产品金额的动态计算
	 *综合演示 
	 */
	//这是定义的数据 可以ajax从服务器去取
	var oldlist = [//定义一个变量
		{id:1000,name:'iphone5s',quantity:3,price:4300},
		{id:2000,name:'iphone5s',quantity:3,price:4300},
		{id:3000,name:'iphone5',quantity:30,price:3300},
		{id:4000,name:'imac',quantity:4,price:23000},
		{id:5000,name:'ipad',quantity:5,price:6900}
	];
	var list = [//定义一个变量
		{"productId":"600100002115","productName":"黄鹤楼香烟","productImage":"https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1625661925,3836246017&fm=23&gp=0.jpg","productPrice":19,"productQuentity":1},
		{"productId":"600100002120","productName":"加多宝","productImage":"https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1977175104,1743950491&fm=23&gp=0.jpg", "productPrice":23,"productQuentity":3},
		{"productId":"600100002130","productName":"大宝护肤","productImage":"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=2558352987,967744455&fm=23&gp=0.jpg","productPrice":30,"productQuentity":2},
		{"productId":"600100002140","productName":"小兔子音乐","productImage":"https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2904099363,919451916&fm=23&gp=0.jpg","productPrice":40,"productQuentity":5},
		{"productId":"600100002150","productName":"小宝宝水壶","productImage":"https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=163271989,291239489&fm=23&gp=0.jpg","productPrice":50,"productQuentity":4}
	];
	
	//vm.$set(object,key,value) //往全局变量里注册一个方法
	//vm.$delete(object,key)    //往全局变量里删除一个监听的方法
	
	new Vue({ // 创建根实例
		el: '#app',//Vue需要监听的模型范围  模型对象
		data:{//模型  模板反向的去操作DOM  代理数据  模型   数据的改变都会反向去操作dom
			title:"Hello Vue",//数据可以使用vue-resoure.min.js插件调用服务器的数据
			totalMoney:0,
			checkAllFlag:false,//是否全选
			productList:[],
			delFlag:false,
			curProduct:false
		},
		filters:{//全局的过滤器和局部的过滤器 这里是局部过滤器
			formatMoney:function(value){ //局部过滤器
				return "￥"+value.toFixed(2);//数字2位一般不前端处理为2位小数点，有精度问题 一般后端处理
			}
		},	
		mounted:function(){//生命周期里的一部分  查询某一个方法			
			this.cartView(); //执行某一方法  和vue-resoure.min.js配合使用  
				
		},		 
		methods:{//事件的绑定
			cartView:function(){
				//alert("执行到了");
				//alert("this "+this.$http);				
				this.title="xiali Vue";
				/*
				var _this=this;
				//alert("AA  "+this.$http.get);
				//vm和Vue是一个东西如果使用vm 则在钩子函数加入nextTick
				this.$http.post("http://weixin2.lumingyouyou.com:8080/caishuijia_server/userController/getUserById.json",{"userId":"f5d3ea786b9e46299c74b79c33a4cc34"}).then(function(res){
					//.$http.post (post方法)  .$http.get(get方法) 服务器的数据已经能取到了
					_this.productList=list;
					_this.totalMoney =18;
				}); //this相当于vue实例 调用vue下的$http下的方法  方法有get
				*/
				let _this=this;
				//这里是一个POST网络请求  需要 vue-resource.js这个js配合
				/*
				this.$http.post("http://weixin2.lumingyouyou.com:8080/caishuijia_server/userController/getUserById.json",{"userId":"f5d3ea786b9e46299c74b79c33a4cc34"}).then(res=>{//res 相当于函数的参数 =>是代替一个函数  {} 函数体
					//.$http.post (post方法)  .$http.get(get方法) 服务器的数据已经能取到了
					//this作用域已经指向了外层了不用改指向了
					this.productList=list;					
					this.totalMoney =18;
				});
				*/
				this.productList=list;					
				//this.totalMoney =18;
			},
			changeMoney:function(product,way){
				//alert("执行到了"+product);//执行到了[object Object]
				/*
				for(attr in product){
					alert("A  "+product[attr] ); //遍历整个list数组里某一个对象的属性
				}
				*/	
				if(way>0){ //用户点击了+
					product.productQuentity++
				}else {//用户点击了-
					product.productQuentity--
				}
				this.calcTotalPrice();
			},
			selectedProduct:function(item){
				if(typeof item.checked=='undefined'){//如果对象下无 checked属性则为undefined
					//数据里没有 checked这个属性  但是我们业务需要监听这个变量的变化  这里我们用其他的办法
					//第一种
					//alert("执行到这里A");
					//Vue.set(item,"checked",true);//给item这个对象加一个属性 给加一个checked选中状态	
					this.$set(item,"checked",true);
					
				}else {
					//alert("执行到这里B");					
					//Vue.set(item,"checked",false);//给item这个对象加一个属性 去掉一个checked 去掉选中状态
					//this.$set(item,"checked",false);
					item.checked=!item.checked;//item.checked这个属性已经有了  我们给它取反					
				}
				this.calcTotalPrice();
			},
			checkAll:function(obj,flag){
				//alert("flag"+flag);
				this.checkAllFlag=flag;
				//document.getElementById(obj);//classList为HTML5一个属性
				//alert("样式 "+document.getElementById(obj).classList);
				/*alert( document.getElementById(obj).classList.contains("checked") );
				if(!document.getElementById(obj).classList.contains("checked")){//如果没有					
				}*/				
				var _this=this; //这里的this是 new Vue出来的这个对象				
				this.productList.forEach(function(item,index){						
					if(typeof item.checked=='undefined'){
						_this.$set(item,"checked",_this.checkAllFlag);
						
					}else{
						//item.checked=true;
						//_this.$set(item,"checked",false);
						item.checked=_this.checkAllFlag;
					}						
				});
				this.calcTotalPrice();
				
			},
			calcTotalPrice:function(){
				var _this=this; //可以用=>箭头函数  箭头函数的this指向问题已经给指向外一层了
				_this.totalMoney=0;
				this.productList.forEach(function(item,index){
					if(item.checked==true){//选中的才进入
						_this.totalMoney += item.productPrice*item.productQuentity;//单价*数量 productPrice","productQuentity
					
					}
				});
			},
			delConfirm(item){
				this.delFlag=true;
				this.curProduct=item; //点击移除 先把要删除的对象给存起来   点击确定删除时就知道要删除那个对象了
			},
			delProduct(){
				//alert("执行到这里");
				//this.delProduct.$delete();//vue 2.0已经开始不支持这个方法了
				//js原生能实现的   vue就不在实现了
				var index=this.productList.indexOf(this.curProduct) ;//获取一下索引
				this.productList.splice(index,1);//删除this.productList这个数组 下的对应的索引数组
				this.delFlag=false;
//				document.getElementById("showModal").style.display="none"
//				if(	document.getElementsByClassName("modal-backdrop")[0] ){					
//					document.body.removeChild(document.getElementsByClassName("modal-backdrop")[0])
//				}
			},
			
			hasClass:function(obj, cls) {  
			    return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));  
			},
			addClass:function(obj, cls) { //增加样式
			    if (!this.hasClass(obj, cls)) obj.className += " " + cls;  
			}		
			
		}
		
		//ESMS6
		//let  常量cant..   =>函数
	}); 
	//定义全局的过滤器
	Vue.filter("money",function(value,type){
		return "￥"+value.toFixed(2)+type;		
	});
	
	
</script>
</body>


</html>